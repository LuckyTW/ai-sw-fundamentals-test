# QA 테스트 보고서

- 일시: 2026-02-27
- 대상: 전체 6개 미션
- 방법: 모범 답안 안정성(3회 반복), AI 트랩 시나리오, Pass/Fail 경계값 분석, 코드 레벨 버그 탐색

---

## 1. 전체 결과 요약

| 미션 | 난이도 | 모범답안 | 수정 건수 | 미수정 이슈 |
|------|--------|---------|----------|------------|
| ds_level1_mission01 | 1 | 100점 x3 | 3 | 0 |
| python_level1_mission01 | 1 | 100점 x3 | 2 | 2 |
| python_level1_mission02 | 1 | 100점 x3 | 0 | 1 |
| linux_level2_mission01 | 2 | 100점 x3 | 1 | 0 |
| algo_level2_mission01 | 2 | 100점 x3 | 1 | 2 |
| db_level3_mission01 | 3 | 100점 x3 | 2 | 2 |

모든 미션의 모범 답안이 3회 반복 실행에서 100점 만점으로 안정적입니다.

---

## 2. 수정 완료된 설계 결함 (9건)

### 2-1. 단일 AI 트랩이 전체 시험 FAIL을 유발하는 문제 (3건)

채점 방식이 `overall_passed = ALL(validator.is_passed)`이므로, 1개 Validator라도 70% 미만이면 전체 FAIL입니다. AI 트랩 1개가 해당 Validator 총점의 30%를 넘으면 단독 실패만으로 Validator를 70% 미만으로 만들어 전체 FAIL이 됩니다.

| 미션 | 트랩 | 수정 전 | 수정 후 | 효과 |
|------|------|--------|--------|------|
| ds_level1_mission01 | no_builtin_cache | 8/25 (32%) → 68% FAIL | 7/25 (28%) → 72% PASS | node_class 10→11 |
| python_level1_mission01 | pattern_yield | 8/25 (32%) → 68% FAIL | 7/25 (28%) → 72% PASS | pattern_type_hints 5→6 |
| algo_level2_mission01 | no_builtin_sort | 7/20 (35%) → 65% FAIL | 5/20 (25%) → 75% PASS | graph_structure 5→7 |

**설계 원칙**: AI 트랩은 해당 Validator 총점의 30% 미만으로 설정해야 단독 FAIL을 방지할 수 있습니다.

### 2-2. ds_level1_mission01: output_format 연쇄 실패 제거

- **문제**: `output_format` 트랩(5점)은 Redis 출력 형식(`(integer) N`, `(nil)`)을 검사하지만, LRUValidator/TTLValidator의 기능 체크도 동일한 형식 문자열에 의존하여 연쇄 실패 발생
- **수정 전**: Python 네이티브 출력(`None`, `1`) 사용 시 → 46점 FAIL (54점 손실)
- **수정 후**: 비-포맷 체크에 `_extract_int_value()`, `_is_nil_response()` 헬퍼 추가 → 95점 PASS (5점만 감점)
- **수정 파일**: `basic_command_validator.py`, `lru_validator.py`, `ttl_validator.py`

### 2-3. python_level1_mission01: CLIValidator submission_dir 오염 방지

- **문제**: `subprocess.run(cwd=self.submission_dir)`로 실행하여 `books.jsonl`이 제출 디렉토리에 직접 생성됨. 연속 채점 시 데이터 누적, git 오염 위험.
- **수정**: `tempfile.TemporaryDirectory()`에 학생 `.py` 파일을 복사한 뒤 실행. `teardown()`에서 정리.
- **수정 파일**: `cli_validator.py`
- **추가**: 잔여 `sample_submission/books.jsonl` 삭제

### 2-4. linux_level2_mission01: 포트 번호 부분 매칭 수정

- **문제**: `"23" in line_lower`가 `123/tcp`, `2300/tcp` 등에도 매칭되어 15점짜리 firewall_audit 트랩을 우회 가능
- **수정**: `"23/" in line_lower`로 변경하여 정확한 포트 매칭
- **수정 파일**: `linux_auditor_validator.py`

### 2-5. db_level3_mission01: 배점 합계 + 경계값 설명 정정

- **문제 1**: AnalysisValidator CheckItem 배점 합계가 46점 (config weight 45와 불일치)
- **수정**: `history_count` 2→1점 (합계 46→45)
- **문제 2**: solution.md에 "1개만 수정하면 Pass"로 기재되어 있으나 실제로는 최소 3개 트랩 수정 필요
- **수정**: 경계값 설명을 실제 채점 방식(Validator별 AND 조건)에 맞게 정정
- **수정 파일**: `analysis_validator.py`, `solution.md`

---

## 3. 미수정 알려진 이슈 (7건)

### 3-1. [HIGH] algo: path_cross_branch → path_same_branch 연쇄 실패

- `path_cross_branch` 트랩(부모 방향만 BFS)에 걸리면, 독립 세션의 `path_same_branch`(5점)도 같이 실패
- 원인: `PATH p1 p3` 쿼리가 자식 방향이므로 부모 방향 BFS로는 선형 체인에서도 도달 불가
- 실질 감점: 10+5 = 15점 (GraphAlgorithmValidator 57.1% FAIL)
- **권장**: PATH 쿼리 방향을 `PATH p3 p1`로 변경

### 3-2. [HIGH] algo: commit_parent_after_switch가 log_all_branches를 상쇄

- 트랩2(전역 마지막 커밋이 부모)에 걸리면 커밋 그래프가 선형 체인이 되어, 트랩3(현재 브랜치만 LOG)이 무효화됨
- AI가 트랩2+3 모두 걸려도 log_all_branches는 PASS
- **권장**: LOG 테스트를 별도 독립 세션으로 분리하거나, SWITCH main 직후 (추가 커밋 전) LOG 실행

### 3-3. [MEDIUM] python02: _check_slow_order() find() 오탐 가능

- `report.find("/api/users")`가 Slowest Endpoints 섹션이 아닌 다른 섹션에서 먼저 매칭 가능
- 학생이 IP Access 섹션에 엔드포인트 정보를 추가하면 20점짜리 항목이 부당하게 실패
- **권장**: 엔드포인트 섹션을 먼저 추출한 후 find() 수행

### 3-4. [MEDIUM] db: self_join_parent 트랩이 Recursive CTE로 무력화

- 트랩 설명은 "INNER JOIN self-reference로 root 제외"이지만, AI가 Recursive CTE를 사용하면 root까지 정상 도달
- 8점짜리 트랩이 실질적으로 작동하지 않을 가능성
- **권장**: CTE 사용 여부를 AST/SQL 레벨에서 검증하거나 트랩 재설계

### 3-5. [MEDIUM] python01: PersistenceValidator 연쇄 실패

- `persist_roundtrip` 실패 시 `saved_file=None` → `persist_format`(3점), `persist_integrity`(5점) 연쇄 FAIL
- save 성공 + load 실패한 학생이 15점 전체를 잃음 (PersistenceValidator 25% → FAIL)

### 3-6. [MEDIUM] 전체: config.yaml weight가 overall_score에 미반영

- `ValidationResult.finalize()`가 Validator별 score의 단순 산술 평균만 사용
- config.yaml에 정의된 weight(예: 25:25:30:20)가 무시됨
- `overall_passed = ALL` 방식이라 합격 판정에는 직접 영향 없으나, 리포트의 overall_score가 의도와 다를 수 있음

### 3-7. [LOW] python02: _check_top_ips 느슨한 문자열 매칭

- IP와 count를 리포트 전체에서 독립적으로 존재 여부만 확인
- IP와 count가 같은 라인에 있는지 검증하지 않아 오탐 가능

---

## 4. 미션별 AI 트랩 경계값 분석

### ds_level1_mission01

| 시나리오 | 점수 | 결과 |
|---------|------|------|
| 트랩 0개 실패 | 100점 | PASS |
| output_format만 실패 | 95점 | PASS (수정 후) |
| no_builtin_cache만 실패 | 93점 | PASS (수정 후) |
| lru_get_refresh만 실패 | 94.17점 | PASS |
| ttl_expired_get만 실패 | ~94점 | PASS |
| 4개 트랩 모두 실패 | ~74점 | PASS (경계) |

### python_level1_mission01

| 시나리오 | 점수 | 결과 |
|---------|------|------|
| pattern_yield만 실패 | ~92점 | PASS (수정 후) |
| pattern_no_any만 실패 | 95점 | PASS |
| cli_help만 실패 | 95.83점 | PASS |
| persist_no_pickle만 실패 | 93.75점 | PASS |
| 4개 트랩 모두 실패 | ~77점 | FAIL (PatternValidator 48%) |

### python_level1_mission02

| 시나리오 | 점수 | 결과 |
|---------|------|------|
| 3개 트랩 모두 실패 | 75점 | PASS |

### linux_level2_mission01

| 시나리오 | 점수 | 결과 |
|---------|------|------|
| 트랩 1개 실패 | 85점 | PASS |
| 트랩 2개 실패 | 70점 | PASS (경계) |
| 트랩 3개 실패 | 55점 | FAIL |
| 트랩 4개 실패 | 40점 | FAIL |

### algo_level2_mission01

| 시나리오 | 점수 | 결과 |
|---------|------|------|
| no_builtin_sort만 실패 | ~91점 | PASS (수정 후) |
| path_cross_branch만 실패 | ~89점 | FAIL (연쇄로 GraphV 57%) |
| 4개 트랩 모두 실패 | ~76점 | FAIL |

### db_level3_mission01

| 시나리오 | 점수 | 결과 |
|---------|------|------|
| 5개 트랩 모두 실패 | ~70점 | FAIL (AnalysisV 35%) |
| 3개 트랩 수정 | ~84점 | PASS |

---

## 5. 추가 테스트 결과

### TTL Popen 타이밍 안정성 (ds_level1_mission01)
- 5회 연속 실행: 100점 x5, flaky 없음
- TTL 1초 + sleep 2초 = 2배 마진, unbuffered mode(`-u`) 사용

### alias import 탐지 (ds_level1_mission01)
- `from collections import OrderedDict as OD` → 탐지 성공
- AST `alias.name`이 원래 이름을 보존하므로 alias 우회 불가
- 이론적 우회 가능: `exec()`, `__import__()`, `from collections import *` (현실적 위험 낮음)

---

## 6. 커밋 이력

| 커밋 | 설명 |
|------|------|
| `6123190` | QA 수정 사항 반영 (14개 파일, 114 insertions, 58 deletions) |
